using System.Collections;
using KBCore.Refs;
using UnityEngine;

public class InvulnerabilityManager : MonoBehaviour {
    private float invulnerabilityTimer;
    
    [SerializeField, Self] private CharacterAttributes character;
    [SerializeField] private float invulnerabilityDuration = 1f;
    public bool IsInvulnerable { get; private set; }

    private void OnEnable() {
        character.OnDamage += TriggerInvulnerability;
    }

    private void OnDisable() {
        character.OnDamage -= TriggerInvulnerability;
    }

    private void TriggerInvulnerability() {
        if (IsInvulnerable) return;
        
        IsInvulnerable = true;
        invulnerabilityTimer = invulnerabilityDuration;
        StartCoroutine(ResetInvulnerability());
    }
    
    private IEnumerator ResetInvulnerability() {
        yield return new WaitForSeconds(invulnerabilityDuration);
        IsInvulnerable = false;
    }
}