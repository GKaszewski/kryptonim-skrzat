using System.Collections;
using KBCore.Refs;
using UnityEngine;

public class InvulnerabilityEffect : MonoBehaviour {

    [SerializeField, Child] private Renderer objectRenderer;
    [SerializeField, Self] private InvulnerabilityManager invulnerabilityManager;
    
    private void Awake() {
        if (objectRenderer) return;
        Debug.LogError("Renderer component not found.");
    }

    private void Update() {
        if (!invulnerabilityManager || !objectRenderer) return;
        
        if (invulnerabilityManager.IsInvulnerable) {
            StartFlashingEffect();
        } else {
            StopFlashingEffect();
        }
    }

    private void StartFlashingEffect() {
        StartCoroutine(FlashEffect());
    }

    private void StopFlashingEffect() {
        StopAllCoroutines();
        objectRenderer.enabled = true;
    }

    private IEnumerator FlashEffect() {
        while (invulnerabilityManager.IsInvulnerable) {
            objectRenderer.enabled = !objectRenderer.enabled;
            yield return new WaitForSeconds(0.1f);
        }

        objectRenderer.enabled = true;
    }
}